source("~/Desktop/microsporidia_nlp/src/3_train_pipelines/microsp_host_relation_extraction/clean_recorded_host_data.R", echo=TRUE)
source("~/Desktop/microsporidia_nlp/src/3_train_pipelines/microsp_host_relation_extraction/clean_recorded_host_data.R", echo=TRUE)
source("~/Desktop/microsporidia_nlp/src/3_train_pipelines/microsp_host_relation_extraction/clean_recorded_host_data.R", echo=TRUE)
species_hosts <- read_csv('../../../data/manually_format_multi_species_papers.csv') %>%
select(species, num_papers, paper_title, title_abstract, hosts_natural,
hosts_experimental) %>%
mutate(hosts_natural = clean_species_names(hosts_natural),
hosts_experimental = clean_species_names(hosts_experimental),
species_cleaned = clean_species_names(species),
all_hosts = combine_all_hosts(hosts_natural, hosts_experimental)) %>%
rowwise() %>%
mutate(hosts_not_in_text = get_species_not_in_text(all_hosts, title_abstract),
microsp_not_in_text = get_species_not_in_text(species, title_abstract)) %>%
ungroup() %>%
mutate(hosts_not_in_text_corrected = NA,
microsp_not_in_text_corrected = NA)
to_manually_correct <- species_hosts %>%
filter(!is.na(hosts_not_in_text) | !is.na(microsp_not_in_text))
if (!file.exists('../../../data/manually_correct_recorded_hosts.csv')) {
write_csv(to_manually_correct, '../../../data/manually_correct_recorded_hosts.csv')
stop("Please manually annotate microsporidia and host names in csv outputted")
} else {
manually_corrected <- read_csv('../../../data/manually_correct_recorded_hosts.csv')
if (all(is.na(manually_corrected$hosts_not_in_text_corrected)) &
all(is.na(manually_corrected$microsp_not_in_text_corrected))) {
stop("Microsporidia and host names in texts were not manually corrected")
} else {
tmp <- species_hosts %>%
filter(!(species %in% manually_corrected$species)) %>%
bind_rows(manually_corrected) %>%
mutate(hosts_in_text = resolve_species(all_hosts, hosts_not_in_text,
hosts_not_in_text_corrected),
microsp_in_text = resolve_species(species_cleaned, microsp_not_in_text,
microsp_not_in_text_corrected)) %>%
filter(num_papers == 1, !is.na(title_abstract),
!is.na(hosts_in_text) | !is.na(microsp_in_text)) %>%
select(species, title_abstract, species_cleaned, all_hosts, hosts_in_text,
microsp_in_text) %>%
mutate(all_hosts = ifelse(is.na(all_hosts), '', all_hosts),
hosts_in_text = ifelse(is.na(hosts_in_text), '', hosts_in_text),
microsp_in_text = ifelse(is.na(microsp_in_text), '', microsp_in_text)) %>%
group_by(title_abstract) %>%
mutate(species = str_c(species, collapse = ' || '),
species_cleaned = str_c(species_cleaned, collapse = ' || '),
all_hosts = str_c(all_hosts, collapse = ' || '),
hosts_in_text = str_c(hosts_in_text, collapse = ' || '),
microsp_in_text = str_c(microsp_in_text, collapse = ' || ')) %>%
distinct(.keep_all = T)
\
species_hosts <- read_csv('../../../data/manually_format_multi_species_papers.csv') %>%
select(species, num_papers, paper_title, title_abstract, hosts_natural,
hosts_experimental) %>%
mutate(hosts_natural = clean_species_names(hosts_natural),
hosts_experimental = clean_species_names(hosts_experimental),
species_cleaned = clean_species_names(species),
all_hosts = combine_all_hosts(hosts_natural, hosts_experimental)) %>%
rowwise() %>%
mutate(hosts_not_in_text = get_species_not_in_text(all_hosts, title_abstract),
microsp_not_in_text = get_species_not_in_text(species, title_abstract)) %>%
ungroup() %>%
mutate(hosts_not_in_text_corrected = NA,
microsp_not_in_text_corrected = NA)
to_manually_correct <- species_hosts %>%
filter(!is.na(hosts_not_in_text) | !is.na(microsp_not_in_text))
if (!file.exists('../../../data/manually_correct_recorded_hosts.csv')) {
write_csv(to_manually_correct, '../../../data/manually_correct_recorded_hosts.csv')
stop("Please manually annotate microsporidia and host names in csv outputted")
} else {
manually_corrected <- read_csv('../../../data/manually_correct_recorded_hosts.csv')
if (all(is.na(manually_corrected$hosts_not_in_text_corrected)) &
all(is.na(manually_corrected$microsp_not_in_text_corrected))) {
stop("Microsporidia and host names in texts were not manually corrected")
} else {
tmp <- species_hosts %>%
filter(!(species %in% manually_corrected$species)) %>%
bind_rows(manually_corrected) %>%
mutate(hosts_in_text = resolve_species(all_hosts, hosts_not_in_text,
hosts_not_in_text_corrected),
microsp_in_text = resolve_species(species_cleaned, microsp_not_in_text,
microsp_not_in_text_corrected)) %>%
filter(num_papers == 1, !is.na(title_abstract),
!is.na(hosts_in_text) | !is.na(microsp_in_text)) %>%
select(species, title_abstract, species_cleaned, all_hosts, hosts_in_text,
microsp_in_text) %>%
mutate(all_hosts = ifelse(is.na(all_hosts), '', all_hosts),
hosts_in_text = ifelse(is.na(hosts_in_text), '', hosts_in_text),
microsp_in_text = ifelse(is.na(microsp_in_text), '', microsp_in_text)) %>%
group_by(title_abstract) %>%
mutate(species = str_c(species, collapse = ' || '),
species_cleaned = str_c(species_cleaned, collapse = ' || '),
all_hosts = str_c(all_hosts, collapse = ' || '),
hosts_in_text = str_c(hosts_in_text, collapse = ' || '),
microsp_in_text = str_c(microsp_in_text, collapse = ' || ')) %>%
distinct(.keep_all = T)
write_csv(tmp, '../../../data/formatted_species_host_data.csv')
}
}
view(tmp)
view(filter(tmp, is.na(hosts_in_text) | is.na(microsp_in_text)))
view(filter(tmp, hosts_in_text == '' | microsp_in_text == ''))

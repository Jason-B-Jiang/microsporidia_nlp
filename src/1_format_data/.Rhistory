collapse = '; ', sep = '; ')
}, vectorize.args = c('hosts_natural', 'hosts_experimental', 'text'))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural, hosts_experimental))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract))
?str_detect
?str_find
get_hosts_not_in_text <- Vectorize(function(hosts_natural, hosts_experimental, text) {
hosts_natural <- str_split(hosts_natural, '; ')[[1]]
hosts_experimental <- str_split(hosts_experimental, '; ')[[1]]
str_c(
c(
hosts_natural[which(!str_detect(text, fixed(hosts_natural)))],
hosts_experimental[which(!str_detect(text, fixed(hosts_experimental)))]
),
collapse = '; ', sep = '; ')
}, vectorize.args = c('hosts_natural', 'hosts_experimental', 'text'))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract))
view(check_recorded_hosts)
get_hosts_not_in_text <- Vectorize(function(hosts_natural, hosts_experimental, text) {
hosts_natural <- str_split(hosts_natural, '; ')[[1]]
hosts_experimental <- str_split(hosts_experimental, '; ')[[1]]
not_in_text <- str_c(
c(
hosts_natural[which(!str_detect(text, fixed(hosts_natural)))],
hosts_experimental[which(!str_detect(text, fixed(hosts_experimental)))]
),
collapse = '; ', sep = '; '
)
if (not_in_text == '') {
return(NA)
}
return(not_in_text)
}, vectorize.args = c('hosts_natural', 'hosts_experimental', 'text'))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract))
view(check_recorded_hosts)
view(filter(check_recorded_hosts, !is.na(hosts_not_in_text)))
view(host_names)
view(host_names)
i = 2
i = 9
str_split(host_names$Host_original[i], ',')[[1]]
make_host_names_hashtable <- function(host_df) {
host_hash <- new.env()
for (i in 1 : nrow(host_df)) {
host_hash[[host_df$Host_formatted[i]]] <-
str_split(host_df$Host_original[i], ',')[[1]]
}
return(host_hash)
}
host_names <- make_host_names_hashtable(
read_xlsx('../../data/Table S2 Host Masterlist.xlsx')
)
host_names[['Acanthocyclops parcus']]
check <- filter(check_recorded_hosts, !is.na(hosts_not_in_text))
view(check)
view(check)
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
return(hosts_not_in_text[which(!(hosts_not_in_text %in% host_names))])
}
Sys.getenv()
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
return(
hosts_not_in_host_names[which(is.null(host_names[[hosts_not_in_host_names]]))]
)
}
host_names
hosts_not_in_host_names('Aedes dorsalis; Aedes caspius', host_names)
host_df <- read_xlsx('../../data/Table S2 Host Masterlist.xlsx')
view(host_df)
lapply(host_df$Host_original, function(x) {str_split(x, ',')[[1]]})
lapply(host_df$Host_original, function(x) {str_split(x, ',')[[1]]})[[600]]
lapply(host_df$Host_original, function(x) {str_split(x, ',')[[1]]})[[999]]
length(lapply(host_df$Host_original, function(x) {str_split(x, ',')[[1]]})[[999]])
make_host_names_list <- function(host_df) {
host_names <- lapply(host_df$Host_original, function(x) {str_split(x, ',')[[1]]})
names(host_names) <- host_df$Host_formatted
return(host_names)
}
host_names <- make_host_names_list(host_df)
view(host_names)
host_names
host_names[[999]]
host_names[999]
host_names[['Oncorhynchus mykiss']]
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
return(hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))])
}
hosts_not_in_host_names('Oncorhynchus mykiss; Broski jabroski', host_names)
hosts_not_in_host_names('Oncorhynchus mykiss; Broski jabroski; Aedes punctor', host_names)
hosts_not_in_host_names('Oncorhynchus mykiss; Broski jabroski; Aedes punctor', host_names)
hosts_not_in_host_names('Oncorhynchus mykiss; Aedes punctor', host_names)
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
}
hosts_not_in_host_names('Oncorhynchus mykiss; Aedes punctor', host_names)
hosts_not_in_host_names('Oncorhynchus mykiss; Aedes punctor; Broski jabroski', host_names)
hosts_not_in_host_names <- Vectorize(function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
} vectorize.args = c('hosts_not_in_text', 'host_names'))
hosts_not_in_host_names <- Vectorize(function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
}, vectorize.args = c('hosts_not_in_text', 'host_names'))
make_host_names_list <- function(host_df) {
host_names <- lapply(host_df$Host_original, function(x) {str_split(x, ',')[[1]]})
names(host_names) <- host_df$Host_formatted
return(host_names)
}
microsp_df <- read_csv('../../data/manually_format_multi_species_papers.csv')
# list mapping "canonical" species names back to original recorded
# entries in dataset
host_names <- make_host_names_list(
read_xlsx('../../data/Table S2 Host Masterlist.xlsx')
)
names(host_names)
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract),
hosts_not_in_hosts_names(hosts_not_in_text, host_names))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract),
hosts_not_in_host_names(hosts_not_in_text, host_names))
hosts_not_in_host_names <- Vectorize(function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
}, vectorize.args = c('hosts_not_in_text', 'host_names'))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract),
hosts_not_in_host_names(hosts_not_in_text, host_names))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract)) %>%
rowwise() %>%
mutate(hosts_not_in_host_names(hosts_not_in_text, host_names))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract)) %>%
rowwise() %>%
mutate(hosts_not_in_host_names = hosts_not_in_host_names(hosts_not_in_text,
host_names))
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract))
view(check_recorded_hosts)
host_names
hosts_not_in_host_names('Aedes punctor; Hello there', host_names)
hosts_not_in_text <- ''Aedes punctor; Hello there''
hosts_not_in_text <- 'Aedes punctor; Hello there'
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
hosts_not_in_text
hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
missing
str_c(missing, collapse = '; ')
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
}
hosts_not_in_host_names(hosts_not_in_text, host_names)
hosts_not_in_text
hosts_not_in_host_names(hosts_not_in_text, host_names)
hosts_not_in_text <- c("Aedes punctor", "Hello there")
hosts_not_in_text
hosts_not_in_text <- "Aedes punctor; Hello there"
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
missing
hosts_not_in_text <- "Aedes punctor; Hello there"
hosts_not_in_host_names(hosts_not_in_text, host_names)
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
}
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract)) %>%
rowwise() %>%
mutate(hosts_not_in_host_names = hosts_not_in_host_names(hosts_not_in_text,
host_names))
view(check_recorded_hosts)
double_check <- filter(check_recorded_hosts, is.na(hosts_not_in_host_names))
double_check <- filter(check_recorded_hosts, !is.na(hosts_not_in_host_names))
view(double_check)
view(host_df)
view(host_df)
x <- list(1, 2, 3, 4, 5, 6)
?which
which(x > 2)
x
x
x
which(x %% 2 == 1)
x
host_names
lapply(host_names, function(x) {'Salmo gairdneri' %in% x})
sapply(host_names, function(x) {'Salmo gairdneri' %in% x})
hosts_not_in_text
host_names
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
hosts_not_in_text
missing <- hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]
missing
missing[!any(sapply(host_names, function(x) {missing %in% x}))]
missing <- c("Hello there", "Otiorynchus sulcatus")
missing[!any(sapply(host_names, function(x) {missing %in% x}))]
missing
missing[!any(sapply(host_names, function(x) {missing %in% x}))]
missing
missing <- c()
missing <- c(missing, 'hello')
missing
missing <- c(missing, 'there')
missing
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- c()
for (h in hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]) {
if (!any(sapply(host_names, function(x) {h %in% x}))) {
missing <- c(missing, h)
}
}
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
}
hosts_not_in_host_names('Hello there; Aedes punctor; Broski babroski; Aedes cantador', host_names)
hosts_not_in_host_names('Hello there; Aedes punctor; Broski babroski; Aedes cantador; Diacyclops bicuspidatus thomasi', host_names)
hosts_not_in_host_names('Hello there; Aedes punctor; Broski babroski; Aedes cantador; Diacyclops bicuspidatus thomasi; James bond', host_names)
## Helper functions
make_host_names_list <- function(host_df) {
host_names <- lapply(host_df$Host_original, function(x) {str_split(x, ',')[[1]]})
names(host_names) <- host_df$Host_formatted
return(host_names)
}
get_hosts_not_in_text <- Vectorize(function(hosts_natural, hosts_experimental, text) {
hosts_natural <- str_split(hosts_natural, '; ')[[1]]
hosts_experimental <- str_split(hosts_experimental, '; ')[[1]]
not_in_text <- str_c(
c(
hosts_natural[which(!str_detect(text, fixed(hosts_natural)))],
hosts_experimental[which(!str_detect(text, fixed(hosts_experimental)))]
),
collapse = '; ', sep = '; '
)
if (not_in_text == '') {
return(NA)
}
return(not_in_text)
}, vectorize.args = c('hosts_natural', 'hosts_experimental', 'text'))
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- c()
for (h in hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]) {
if (!any(sapply(host_names, function(x) {h %in% x}))) {
missing <- c(missing, h)
}
}
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
}
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract)) %>%
rowwise() %>%
mutate(hosts_not_in_host_names = hosts_not_in_host_names(hosts_not_in_text,
host_names))
view(check_recorded_hosts)
view(filter(check_recorded_hosts, !is.na(hosts_not_in_host_names)))
?str_remove
str_remove('Culex sp. (2)', '\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
str_remove('Culex sp. (2)', ' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
str_remove('Culex sp. (2)', ' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
str_remove('Solenopsis geminata (type host)', ' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
str_remove('Solenopsis geminata (type)', ' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
str_remove('Mesocyclops sp. (intermediate host)', ' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
str_remove(c('Mesocyclops sp. (intermediate host)', 'Culex sp. (2)'), ' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
clean_host_names <- Vectorize(function(hosts) {
hosts <- str_remove(
str_split(hosts, '; '),
' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
return(str_c(hosts, collapse = '; '))
})
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_natural = clean_host_names(hosts_natural),
hosts_experimental = clean_host_names(hosts_experimental),
hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract)) %>%
rowwise() %>%
mutate(hosts_not_in_host_names = hosts_not_in_host_names(hosts_not_in_text,
host_names))
warnings()
view(microsp_df)
str_split(NA, '; ')[[1]]
## Helper functions
make_host_names_list <- function(host_df) {
host_names <- lapply(host_df$Host_original, function(x) {str_split(x, ',')[[1]]})
names(host_names) <- host_df$Host_formatted
return(host_names)
}
clean_host_names <- Vectorize(function(hosts) {
if (is.na(hosts)) {
return(NA)
}
hosts <- str_remove(
str_split(hosts, '; '),
' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
return(str_c(hosts, collapse = '; '))
})
get_hosts_not_in_text <- Vectorize(function(hosts_natural, hosts_experimental, text) {
hosts_natural <- str_split(hosts_natural, '; ')[[1]]
hosts_experimental <- str_split(hosts_experimental, '; ')[[1]]
not_in_text <- str_c(
c(
hosts_natural[which(!str_detect(text, fixed(hosts_natural)))],
hosts_experimental[which(!str_detect(text, fixed(hosts_experimental)))]
),
collapse = '; ', sep = '; '
)
if (not_in_text == '') {
return(NA)
}
return(not_in_text)
}, vectorize.args = c('hosts_natural', 'hosts_experimental', 'text'))
hosts_not_in_host_names <- function(hosts_not_in_text, host_names) {
hosts_not_in_text <- str_split(hosts_not_in_text, '; ')[[1]]
missing <- c()
for (h in hosts_not_in_text[which(!(hosts_not_in_text %in% names(host_names)))]) {
if (!any(sapply(host_names, function(x) {h %in% x}))) {
missing <- c(missing, h)
}
}
if (length(missing) == 0) {
return(NA)
}
return(str_c(missing, collapse = '; '))
}
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_natural = clean_host_names(hosts_natural),
hosts_experimental = clean_host_names(hosts_experimental),
hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract)) %>%
rowwise() %>%
mutate(hosts_not_in_host_names = hosts_not_in_host_names(hosts_not_in_text,
host_names))
warnings()
clean_host_names <- Vectorize(function(hosts) {
if (is.na(hosts)) {
return(NA)
}
hosts <- str_remove(
str_split(hosts, '; '),
' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
return(str_c(hosts, collapse = '; '))
})
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_natural = clean_host_names(hosts_natural),
hosts_experimental = clean_host_names(hosts_experimental))
view(check_recorded_hosts)
clean_host_names <- Vectorize(function(hosts) {
hosts <- str_remove(
str_split(hosts, '; ')[[1]],
' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite).*\\)')
return(str_c(hosts, collapse = '; '))
})
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_natural = clean_host_names(hosts_natural),
hosts_experimental = clean_host_names(hosts_experimental),
hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract)) %>%
rowwise() %>%
mutate(hosts_not_in_host_names = hosts_not_in_host_names(hosts_not_in_text,
host_names))
view(check_recorded_hosts)
view(filter(check_recorded_hosts, !is.na(hosts_not_in_host_names())))
view(filter(check_recorded_hosts, !is.na(hosts_not_in_host_names)))
clean_host_names <- Vectorize(function(hosts) {
hosts <- str_remove(
str_split(hosts, '; ')[[1]],
' ?\\((\\d|intermediate|definitive|type|also|\\?|family|in|parasite|female|experimental).*\\)')
return(str_c(hosts, collapse = '; '))
})
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_natural = clean_host_names(hosts_natural),
hosts_experimental = clean_host_names(hosts_experimental),
hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract)) %>%
rowwise() %>%
mutate(hosts_not_in_host_names = hosts_not_in_host_names(hosts_not_in_text,
host_names))
view(filter(check_recorded_hosts, !is.na(hosts_not_in_host_names))
)
view(check_recorded_hosts)
to_correct <- filter(check_recorded_hosts, !is.na(hosts_not_in_text))
view(to_correct)
check_recorded_hosts <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_natural = clean_host_names(hosts_natural),
hosts_experimental = clean_host_names(hosts_experimental),
hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract),
hosts_not_in_text_corrected = NA)
view(check_recorded_hosts)
to_manually_correct <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_natural = clean_host_names(hosts_natural),
hosts_experimental = clean_host_names(hosts_experimental),
hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract),
hosts_not_in_text_corrected = NA) %>%
filter(!is.na(hosts_not_in_text))
view(to_manually_correct)
write_csv(to_manually_correct, '../../data/manually_correct_recorded_hosts.csv')
view(host_df)
clean_host_names <- Vectorize(function(hosts) {
hosts <- str_remove(str_split(hosts, '; ')[[1]], ' ?\\(.+\\)')
return(str_c(hosts, collapse = '; '))
})
microsp_df <- read_csv('../../data/manually_format_multi_species_papers.csv')
# list mapping "canonical" species names back to original recorded
# entries in dataset
host_names <- make_host_names_list(
read_xlsx('../../data/Table S2 Host Masterlist.xlsx')
)
to_manually_correct <- microsp_df %>%
select(species, paper_title, title_abstract, hosts_natural, hosts_experimental) %>%
mutate(hosts_natural = clean_host_names(hosts_natural),
hosts_experimental = clean_host_names(hosts_experimental),
hosts_not_in_text = get_hosts_not_in_text(hosts_natural,
hosts_experimental,
title_abstract),
hosts_not_in_text_corrected = NA) %>%
filter(!is.na(hosts_not_in_text))
write_csv(to_manually_correct, '../../data/manually_correct_recorded_hosts.csv')
view(host_df)
view(check_recorded_hosts)
view(microsp_df)
